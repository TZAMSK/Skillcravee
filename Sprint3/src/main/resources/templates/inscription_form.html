
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Inscription</title>
  <link th:href="@{/css/inscription.css}" rel="stylesheet" type="text/css" />
  <link th:href="@{/css/alert.css}" rel="stylesheet" type="text/css" />
  <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
  <script src="http://cdn.jsdelivr.net/jquery.validation/1.14.0/jquery.validate.min.js"></script>

</head>
<body class="couleur">
<div class="formulaire">
  <div class="contenu">
    <a th:href= "@{/}"><img height="60"  width="80" th:src="@{/images/logo.PNG}"/></a>
    <h1 class="h1">BIENVENUE</h1>
    <div th:if="${message!=null}" class="alert">
      [[${message}]]
    </div>
    <p>Entrez les informations suivantes :</p>

    <form th:object="${formulaire}" th:action="@{/index/save}" method="post" enctype="multipart/form-data">
      <div class="inputInscription">
        <select name="selection" onchange="showFields(this)">
          <option>Choisissez une option</option>
          <option>Étudiant</option>
          <option>Professeur</option>
          <option>Entreprise</option>
        </select>
        <br><br>
        <div id="etudiant-fields" class="form-fields">
          <input th:field="*{etudiant.nom}" type="text" placeholder="Nom"/>
          <input th:field="*{etudiant.prenom}" type="text" placeholder="Prenom"/>
          <input th:field="*{etudiant.email}" type="text" placeholder="Email"/>
          <input th:field="*{etudiant.password}" type="password" placeholder="Password"/>
          <div class="col-sm-10">
            <input type="file" id="file" name="file"/>
          </div>
        </div>
        <div id="professeur-fields" class="form-fields">
          <input th:field="*{prof.nom}" type="text" placeholder="Nom"/>
          <input th:field="*{prof.prenom}" type="text" placeholder="Prenom"/>
          <input th:field="*{prof.email}" type="text" placeholder="Email"/>
          <input th:field="*{prof.password}" type="password" placeholder="Password"/>
        </div>
        <div id="entreprise-fields" class="form-fields">
          <input th:field="*{entreprise.nom}" type="text" placeholder="Nom"/>
          <input th:field="*{entreprise.address}" type="text" placeholder="Adress"/>
          <input th:field="*{entreprise.telephone}" type="text" placeholder="Telephone"/>
          <input th:field="*{entreprise.email}" type="text" placeholder="Email"/>
          <input th:field="*{entreprise.password}" type="password" placeholder="Password"/>
        </div>
      </div>
      <br>
      <p>Déjà inscrit ?</p>
      <a th:href="@{/login}">Connectez-vous</a>
      <button type="submit" class="bouton" name="next">Submit</button>
    </form>

    <script>
      function showFields(selectElement) {
        var selectedOption = selectElement.value;

        // Hide all form fields
        $(".form-fields").hide();

        // Show form fields based on selected option
        if (selectedOption === "Étudiant") {
          $("#etudiant-fields").show();
        } else if (selectedOption === "Professeur") {
          $("#professeur-fields").show();
        } else if (selectedOption === "Entreprise") {
          $("#entreprise-fields").show();
        }
      }

      $(document).ready(function() {
        // Hide all the form fields initially
        $(".form-fields").hide();

        // Show form fields based on selected option
        $("select[name='selection']").change(function() {
          showFields(this);
        });
      });

      function checkEmailUnique(form) {
        // Si le fichier dépasse la limite autorisée, on ne soumet pas le formule
        if (!validateFile(document.getElementById('file'))) {
          return false;
        }


        $.ajax({

          type : 'POST',
          url :  '[[@{/etudiant/check_email}]]',
          data: {email:$("#email").val(),id:$("#id").val()},

          success : function(data) {
            //   alert("Reponse venant du Serveur " + data);

            if(data==='OK'){
              form.submit();
            }else{
              // alert("Il y a déjà un utilisateur avec le même email : " + $("#email").val());
              showModalDialog("Avertissement", "Il y a déjà un etudiant avec le même email : " + $("#email").val())
            }
          }
        });

        return false;
      }

      function showModalDialog(title, message) {
        $("#modalTitle").text(title);
        $("#modalBody").text(message);
        $("#modalDialog").modal();

      }

      $("#buttonCancel").on("click", function () {
        //L'objet window.location peut être utilisé pour obtenir l'adresse de la page actuelle (URL)
        // et pour rediriger le navigateur vers une nouvelle page
        window.location = "[[@{/etudiant}]]";
      });
      function validateFile(input) {
        let fileSize = input.files[0].size;
        let maxSize = 10 * 1024 * 1024; // 10 MB

        if (fileSize > maxSize) {
          showModalDialog("Erreur", "la taille " + fileSize + " du fichier  " + $("#file").val()+ " dépasse la taille limite autorisée qui est " + maxSize+ " soit 10MB")
          input.value = ""; // Efface le champ de saisie de fichier
          return false;
        }

        return true;
      }
    </script>
    <style>
      .form-fields {
        display: none;
      }
    </style>
  </div>
</div>
</body>
</html>
